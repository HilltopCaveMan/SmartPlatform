<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="CarReportData" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="SqlMap.xsd">
  <alias>
    <typeAlias alias="ZxtjView" type="GModel.Car.CarReport_ZXTJView" />
    <typeAlias alias="LxtjView" type="GModel.Car.CarReport_LXTJView" />
    <typeAlias alias="LcbbView" type="GModel.Car.CarReport_LCBBView" />
    <typeAlias alias="TerDataView" type="GModel.Car.CarReport_TerData" />
  </alias>
  <resultMaps>
    <resultMap id="ZxtjViewResult" class="ZxtjView">
      <result property="TerNo" column="TerNo" type="string" dbType="varchar"/>
      <result property="CarNo" column="CarNo" type="string" dbType="varchar"/>
      <result property="Rtime" column="Rtime" type="DateTime" dbType="DateTime"/>
      <result property="Position" column="Position" type="string" dbType="varchar"/>
    </resultMap>

    <resultMap id="LxtjViewResult" class="LxtjView">
      <result property="TerNo" column="TerNo" type="string" dbType="varchar"/>
      <result property="CarNo" column="CarNo" type="string" dbType="varchar"/>
      <result property="Rtime" column="Rtime" type="DateTime" dbType="DateTime"/>
      <result property="NotrtimeDay" column="NotrtimeDay" type="string" dbType="varchar"/>
      <result property="Position" column="Position" type="string" dbType="varchar"/>
    </resultMap>

    <resultMap id="LcbbViewResult" class="LcbbView">
      <result property="ID" column="ID" type="string" dbType="varchar"/>
      <result property="TerNo" column="TerNo" type="string" dbType="varchar"/>
      <result property="DepCode" column="DepCode" type="string" dbType="varchar"/>
      <result property="StatDate" column="StatDate" type="string" dbType="varchar"/>
      <result property="RunTime" column="RunTime" type="string" dbType="varchar"/>
      <result property="StopTime" column="StopTime" type="string" dbType="varchar"/>
      <result property="StopCount" column="StopCount" type="string" dbType="varchar"/>
      <result property="DayMile" column="DayMile" type="string" dbType="varchar"/>
      <result property="DaySumMile" column="DaySumMile" type="string" dbType="varchar"/>
    </resultMap>

    <resultMap id="TerDataViewResult" class="TerDataView">
      <result property="Id" column="Id" type="string" dbType="varchar"/>
      <result property="Rawdataid" column="Rawdataid" type="string" dbType="varchar"/>
      <result property="TerNo" column="TerNo" type="string" dbType="varchar"/>
      <result property="CarNo" column="CarNo" type="string" dbType="varchar"/>
      <result property="ProName" column="ProName" type="string" dbType="varchar"/>
      <result property="StateName" column="StateName" type="string" dbType="varchar"/>
      <result property="GenerationNum" column="GenerationNum" type="string" dbType="varchar"/>
      <result property="Factorynum" column="Factorynum" type="string" dbType="varchar"/>
      <result property="Rtime" column="Rtime" type="DateTime" dbType="DateTime"/>
      <result property="Protocolversion" column="Protocolversion" type="string" dbType="varchar"/>
      <result property="Programverson" column="Programverson" type="string" dbType="varchar"/>
      <result property="Gpsverson" column="Gpsverson" type="string" dbType="varchar"/>
      <result property="Positioningtime" column="Positioningtime" type="DateTime" dbType="DateTime"/>
      <result property="TerStatus" column="TerStatus" type="string" dbType="varchar"/>
      <result property="TerModel" column="TerModel" type="string" dbType="varchar"/>
      <result property="Worktime" column="Worktime" type="double" dbType="Real"/>
      <result property="Sleeptime" column="Sleeptime" type="string" dbType="varchar"/>
      <result property="Ntervalltime" column="Ntervalltime" type="string" dbType="varchar"/>
      <result property="TerVbatt" column="TerVbatt" type="string" dbType="varchar"/>
      <result property="Totalworktime" column="Totalworktime" type="double" dbType="Real"/>
      <result property="Blinddatanum" column="Blinddatanum" type="string" dbType="varchar"/>
      <result property="TerStatrtimes" column="TerStatrtimes" type="string" dbType="varchar"/>
      <result property="Ifblinddata" column="Ifblinddata" type="string" dbType="varchar"/>
      <result property="Ifposition" column="Ifposition" type="string" dbType="varchar"/>
      <result property="Northorsouth" column="Northorsouth" type="string" dbType="varchar"/>
      <result property="Eastorwest" column="Eastorwest" type="string" dbType="varchar"/>
      <result property="Latitude" column="Latitude" type="double" dbType="Real"/>
      <result property="Longitude" column="Longitude" type="double" dbType="Real"/>
      <result property="BaiduLatitude" column="BaiduLatitude" type="double" dbType="Real"/>
      <result property="BaiduLongitude" column="BaiduLongitude" type="double" dbType="Real"/>
      <result property="GoogleLatitude" column="GoogleLatitude" type="double" dbType="Real"/>
      <result property="GoogleLongitude" column="GoogleLongitude" type="double" dbType="Real"/>
      <result property="Position" column="Position" type="string" dbType="varchar"/>
      <result property="Speed" column="Speed" type="string" dbType="varchar"/>
      <result property="Direction" column="Direction" type="string" dbType="varchar"/>
      <result property="Height" column="Height" type="string" dbType="varchar"/>
      <result property="Gpsant" column="Gpsant" type="string" dbType="varchar"/>
      <result property="Usesatellite" column="Usesatellite" type="double" dbType="Real"/>
      <result property="Visualsatellite" column="Visualsatellite" type="double" dbType="Real"/>
      <result property="Gpsrssi" column="Gpsrssi" type="string" dbType="varchar"/>
      <result property="Gsmrssi" column="Gsmrssi" type="string" dbType="varchar"/>
      <result property="Lca" column="Lca" type="string" dbType="varchar"/>
      <result property="Cell" column="Cell" type="string" dbType="varchar"/>
      <result property="Gsmrssi1" column="Gsmrssi1" type="string" dbType="varchar"/>
      <result property="Lca1" column="Lca1" type="string" dbType="varchar"/>
      <result property="Cell1" column="Cell1" type="string" dbType="varchar"/>
      <result property="Gsmrssi2" column="Gsmrssi2" type="string" dbType="varchar"/>
      <result property="Lca2" column="Lca2" type="string" dbType="varchar"/>
      <result property="Cell2" column="Cell2" type="string" dbType="varchar"/>
      <result property="Gsmrssi3" column="Gsmrssi3" type="string" dbType="varchar"/>
      <result property="Lca3" column="Lca3" type="string" dbType="varchar"/>
      <result property="Cell3" column="Cell3" type="string" dbType="varchar"/>
      <result property="Province" column="Province" type="string" dbType="varchar"/>
      <result property="City" column="City" type="string" dbType="varchar"/>
      <result property="County" column="County" type="string" dbType="varchar"/>
      <result property="Workstate" column="Workstate" type="string" dbType="varchar"/>
      <result property="Postbacktimes" column="Postbacktimes" type="double" dbType="Real"/>
      <result property="Gsmrssi4" column="Gsmrssi4" type="string" dbType="varchar"/>
      <result property="Lca4" column="Lca4" type="string" dbType="varchar"/>
      <result property="Cell4" column="Cell4" type="string" dbType="varchar"/>
      <result property="Gsmrssi5" column="Gsmrssi5" type="string" dbType="varchar"/>
      <result property="Lca5" column="Lca5" type="string" dbType="varchar"/>
      <result property="Cell5" column="Cell5" type="string" dbType="varchar"/>
      <result property="Gsmrssi6" column="Gsmrssi6" type="string" dbType="varchar"/>
      <result property="Lca6" column="Lca6" type="string" dbType="varchar"/>
      <result property="Cell6" column="Cell6" type="string" dbType="varchar"/>
      <result property="Accstate" column="Accstate" type="string" dbType="varchar"/>
      <result property="Lat" column="Lat" type="string" dbType="varchar"/>
      <result property="Lng" column="Lng" type="string" dbType="varchar"/>
      <result property="ReplydataCode" column="ReplydataCode" type="string" dbType="varchar"/>
      <result property="Carworktemp" column="Carworktemp" type="double" dbType="Real"/>
      <result property="RemainlPct" column="RemainlPct" type="string" dbType="varchar"/>
      <result property="AddupDist" column="AddupDist" type="double" dbType="Real"/>
      <result property="TerSimcard" column="TerSimcard" type="string" dbType="varchar"/>
      <result property="Ter_Innettime" column="Ter_Innettime" type="DateTime" dbType="DateTime"/>
      <result property="Ter_Activetime" column="Ter_Activetime" type="DateTime" dbType="DateTime"/>
      <result property="Businessdivisionname" column="Businessdivisionname" type="string" dbType="varchar"/>
      <result property="Businessdivisionid" column="Businessdivisionid" type="string" dbType="varchar"/>
      <result property="Tertypeid" column="Tertypeid" type="string" dbType="varchar"/>
    </resultMap>
  </resultMaps>
  <statements>
    <select id="GetZxtjViewPage" parameterClass="map" resultMap="ZxtjViewResult">
      <isGreaterThan property="EndData" compareValue="0">
        select * from (select op_a.*, rownum rn from (
      </isGreaterThan>
      SELECT
      RD.TER_NO AS TerNo,
      CI.CAR_NO as CarNo,
      RD.RTIME as Rtime,
      RD.POSITION as Position
      FROM REALTIME_DATA RD left join terminal_info TI on RD.TER_NO=TI.TER_NO left Join Dept_info DI on TI.DEPT_ID=DI.BUSINESSDIVISIONID Left join CAR_INFO CI on TI.CAR_ID=CI.CAR_ID
      where cast(sysdate-RD.RTIME as integer)&lt;7.1 and RD.TER_NO is not null and RD.RTIME is not null and RD.ter_status!='2' and RD.ter_status!='5'
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="DeptId">
          TI.DEPT_ID = #DeptId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="DeptCode">
          DI.BUSINESSDIVISIONCODE LIKE #DeptCode#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerTypeId">
          TI.TER_TYPEID = #TerTypeId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CarNo">
          CI.CAR_NO like '%'||#CarNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerNo">
          TI.TER_NO like '%'||#TerNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="st">
          RD.RTIME &gt;= to_date(#st#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="ed">
          RD.RTIME &lt;= to_date(#ed#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
      </dynamic>
      <isGreaterThan property="EndData" compareValue="0">
        ) op_a) op_b Where op_b.rn &lt; #EndData# And op_b.rn &gt;= #StartData#
      </isGreaterThan>
    </select>

    <select id="GetZxtjViewCount" parameterClass="map" resultClass="int">
      SELECT count(*)
      FROM REALTIME_DATA RD left join terminal_info TI on RD.TER_NO=TI.TER_NO left Join Dept_info DI on TI.DEPT_ID=DI.BUSINESSDIVISIONID Left join CAR_INFO CI on TI.CAR_ID=CI.CAR_ID
      where cast(sysdate-RD.RTIME as integer)&lt;7.1 and RD.TER_NO is not null and RD.RTIME is not null and RD.ter_status!='2' and RD.ter_status!='5'
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="DeptId">
          TI.DEPT_ID = #DeptId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="DeptCode">
          DI.BUSINESSDIVISIONCODE LIKE #DeptCode#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerTypeId">
          TI.TER_TYPEID = #TerTypeId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CarNo">
          CI.CAR_NO like '%'||#CarNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerNo">
          TI.TER_NO like '%'||#TerNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="st">
          RD.RTIME &gt;= to_date(#st#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="ed">
          RD.RTIME &lt;= to_date(#ed#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
      </dynamic>
    </select>

    <select id="GetLxtjViewPage" parameterClass="map" resultMap="LxtjViewResult">
      <isGreaterThan property="EndData" compareValue="0">
        select * from (select op_a.*, rownum rn from (
      </isGreaterThan>
      SELECT
      RD.TER_NO AS TerNo,
      CI.CAR_NO as CarNo,
      RD.RTIME as Rtime,
      to_char(cast(sysdate-RD.RTIME as integer)) as NotrtimeDay,
      RD.POSITION as Position
      FROM REALTIME_DATA RD left join terminal_info TI on RD.TER_NO=TI.TER_NO left Join Dept_info DI on TI.DEPT_ID=DI.BUSINESSDIVISIONID Left join CAR_INFO CI on TI.CAR_ID=CI.CAR_ID
      where cast(sysdate-RD.RTIME as integer)&gt;=7.1 and RD.TER_NO is not null and RD.RTIME is not null and RD.ter_status!='2' and RD.ter_status!='5'
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="DeptId">
          TI.DEPT_ID = #DeptId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="DeptCode">
          DI.BUSINESSDIVISIONCODE LIKE #DeptCode#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerTypeId">
          TI.TER_TYPEID = #TerTypeId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CarNo">
          CI.CAR_NO like '%'||#CarNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerNo">
          TI.TER_NO like '%'||#TerNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="st">
          RD.RTIME &gt;= to_date(#st#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="ed">
          RD.RTIME &lt;= to_date(#ed#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
      </dynamic>
      <isGreaterThan property="EndData" compareValue="0">
        ) op_a) op_b Where op_b.rn &lt; #EndData# And op_b.rn &gt;= #StartData#
      </isGreaterThan>
    </select>

    <select id="GetLxtjViewCount" parameterClass="map" resultClass="int">
      SELECT count(*)
      FROM REALTIME_DATA RD left join terminal_info TI on RD.TER_NO=TI.TER_NO left Join Dept_info DI on TI.DEPT_ID=DI.BUSINESSDIVISIONID Left join CAR_INFO CI on TI.CAR_ID=CI.CAR_ID
      where cast(sysdate-RD.RTIME as integer)&gt;=7.1 and RD.TER_NO is not null and RD.RTIME is not null and RD.ter_status!='2' and RD.ter_status!='5'
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="DeptId">
          TI.DEPT_ID = #DeptId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="DeptCode">
          DI.BUSINESSDIVISIONCODE LIKE #DeptCode#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerTypeId">
          TI.TER_TYPEID = #TerTypeId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="CarNo">
          CI.CAR_NO like '%'||#CarNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="TerNo">
          TI.TER_NO like '%'||#TerNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="st">
          RD.RTIME &gt;= to_date(#st#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="ed">
          RD.RTIME &lt;= to_date(#ed#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
      </dynamic>
    </select>

    <select id="GetLcbbData" parameterClass="map" resultMap="LcbbViewResult">
      SELECT ID AS ID,
      TER_NO AS TerNo,
      DEPCODE AS DepCode,
      to_char(STATDATE,'yyyy-mm-dd') AS StatDate,
      DAYMILE AS DayMile,
      DAYSUMMILE AS DaySumMile,
      RUNTIME AS RunTime,
      STOPCOUNT AS StopCount,
      STOPTIME AS StopTime FROM DAYMILESTAT where 1=1
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="TerNo">
          TER_NO=#TerNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="StatDate">
          STATDATE = to_date(#StatDate#,'yyyy-mm-dd hh24:mi:ss')
        </isNotEmpty>
      </dynamic>
       Order by STATDATE
    </select>

    <select id="GetLcbbTodayData" parameterClass="map" resultMap="LcbbViewResult">
      select op_a.*,rownum from (
      SELECT ID AS ID,
      TER_NO AS TerNo,
      DEPCODE AS DepCode,
      to_char(STATDATE,'yyyy-mm-dd') AS StatDate,
      DAYMILE AS DayMile,
      DAYSUMMILE AS DaySumMile,
      RUNTIME AS RunTime,
      STOPCOUNT AS StopCount,
      STOPTIME AS StopTime FROM DAYMILESTATTEMP where 1=1
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="TerNo">
          TER_NO=#TerNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="StatDate">
          to_char(STATDATE,'yyyy-mm-dd') = to_char(to_date(#StatDate#,'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd')
        </isNotEmpty>
      </dynamic>
      Order by STATDATE desc,STOPTIME desc) op_a where rownum=1
    </select>

    <select id="GetTjbbTerData" parameterClass="map" resultMap="TerDataViewResult">
      <isGreaterThan property="EndData" compareValue="0">
        select * from (select op_a.*, rownum rn from (
      </isGreaterThan>
      SELECT TI.TER_GUID              AS Id,
      DI.BUSINESSDIVISIONNAME         AS Businessdivisionname,
      DI.BUSINESSDIVISIONID         AS Businessdivisionid,
      RD.RAWDATAID        AS Rawdataid,
      TI.TER_NO           AS TerNo,
      CI.CAR_NO           AS CarNo,
      PI.PRO_NAME         AS ProName,
      (case when RD.ter_status='2' then '库存'
      when RD.ter_status='5' then '到期'
      when RD.ter_status='6' then '休眠'
      when (cast(sysdate-RD.RTIME as integer) &lt;7.1) then '在线'
      when (cast(sysdate-RD.RTIME as integer) &gt;=7.1 and cast(sysdate-RD.RTIME as integer) &lt;15.1) then CONCAT(CONCAT('离线(',cast(sysdate-RTIME as integer)),'天)')
      when (cast(sysdate-RD.RTIME as integer) &gt;=15.1) then '失联' else '其他' end ) AS StateName,
      RD.GENERATION_NUM   AS GenerationNum,
      RD.FACTORYNUM       AS Factorynum,
      RD.RTIME            AS Rtime,
      RD.PROTOCOLVERSION  AS Protocolversion,
      RD.PROGRAMVERSON    AS Programverson,
      RD.GPSVERSON        AS Gpsverson,
      RD.POSITIONINGTIME  AS Positioningtime,
      RD.TER_STATUS       AS TerStatus,
      RD.TER_MODEL        AS TerModel,
      RD.WORKTIME         AS Worktime,
      RD.SLEEPTIME        AS Sleeptime,
      RD.NTERVALLTIME     AS Ntervalltime,
      RD.TER_VBATT        AS TerVbatt,
      RD.TOTALWORKTIME    AS Totalworktime,
      RD.BLINDDATANUM     AS Blinddatanum,
      RD.TER_STATRTIMES   AS TerStatrtimes,
      RD.IFBLINDDATA      AS Ifblinddata,
      RD.IFPOSITION       AS Ifposition,
      RD.NORTHORSOUTH     AS Northorsouth,
      RD.EASTORWEST       AS Eastorwest,
      RD.LATITUDE         AS Latitude,
      RD.LONGITUDE        AS Longitude,
      RD.BAIDU_LATITUDE   AS BaiduLatitude,
      RD.BAIDU_LONGITUDE  AS BaiduLongitude,
      RD.GOOGLE_LATITUDE  AS GoogleLatitude,
      RD.GOOGLE_LONGITUDE AS GoogleLongitude,
      RD.POSITION         AS Position,
      RD.SPEED            AS Speed,
      RD.DIRECTION        AS Direction,
      RD.HEIGHT           AS Height,
      RD.GPSANT           AS Gpsant,
      RD.USESATELLITE     AS Usesatellite,
      RD.VISUALSATELLITE  AS Visualsatellite,
      RD.GPSRSSI          AS Gpsrssi,
      RD.GSMRSSI          AS Gsmrssi,
      RD.LCA              AS Lca,
      RD.CELL             AS Cell,
      RD.GSMRSSI1         AS Gsmrssi1,
      RD.LCA1             AS Lca1,
      RD.CELL1            AS Cell1,
      RD.GSMRSSI2         AS Gsmrssi2,
      RD.LCA2             AS Lca2,
      RD.CELL2            AS Cell2,
      RD.GSMRSSI3         AS Gsmrssi3,
      RD.LCA3             AS Lca3,
      RD.CELL3            AS Cell3,
      RD.PROVINCE         AS Province,
      RD.CITY             AS City,
      RD.COUNTY           AS County,
      RD.WORKSTATE        AS Workstate,
      RD.POSTBACKTIMES    AS Postbacktimes,
      RD.GSMRSSI4         AS Gsmrssi4,
      RD.LCA4             AS Lca4,
      RD.CELL4            AS Cell4,
      RD.GSMRSSI5         AS Gsmrssi5,
      RD.LCA5             AS Lca5,
      RD.CELL5            AS Cell5,
      RD.GSMRSSI6         AS Gsmrssi6,
      RD.LCA6             AS Lca6,
      RD.CELL6            AS Cell6,
      RD.ACCSTATE         AS Accstate,
      RD.LAT_             AS Lat,
      RD.LNG_             AS Lng,
      RD.REPLYDATACODE    AS ReplydataCode,
      RD.CARWORKTEMP      AS Carworktemp,
      RD.REMAINL_PCT      AS RemainlPct,
      RD.ADDUP_DIST       AS AddupDist,
      TI.TER_TYPEID       AS Tertypeid,
      TI.TER_SIMCARD AS TerSimcard,
      TI.TER_INNETTIME AS Ter_Innettime,
      TI.ACTIVETIME  AS Ter_Activetime
      FROM TERMINAL_INFO TI JOIN DEPT_INFO DI ON TI.DEPT_ID=DI.BUSINESSDIVISIONID
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="TerNo">
          TI.TER_NO LIKE '%'||#TerNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="UserLname">
          TI.TER_NO in (select ter_no from SETMANAGER where username=#UserLname#)
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="ProId">
          TI.TER_TYPEID=#ProId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="StartTerNo">
          TI.TER_NO &gt;=#StartTerNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="EndTerNo">
          TI.TER_NO &lt;=#EndTerNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="DeptId">
          TI.DEPT_ID = #DeptId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="Businessdivisioncode">
          DI.BUSINESSDIVISIONCODE LIKE #Businessdivisioncode#||'%'
        </isNotEmpty>
      </dynamic>
      LEFT JOIN CAR_INFO CI ON TI.CAR_ID = CI.CAR_ID
      LEFT JOIN　PRODUCTS_INFO PI ON TI.TER_TYPEID=PI.PRO_ID
      LEFT JOIN REALTIME_DATA RD ON TI.TER_NO= RD.TER_NO where 1=1
      <isNotEmpty prepend="AND" property="CarNo">
        CI.CAR_NO LIKE '%'||#CarNo#||'%'
      </isNotEmpty>
      <isEqual property="StateId" compareValue="1">
        AND cast(sysdate-RD.RTIME as integer)&lt;7.1 and ((RD.ter_status not in ('2','5','6')) or RD.ter_status is null)
      </isEqual>
      <isEqual property="StateId" compareValue="2">
        AND cast(sysdate-RD.RTIME as integer) &gt;=7.1 and cast(sysdate-RD.RTIME as integer)&lt;15.1 and ((RD.ter_status not in ('2','5','6')) or RD.ter_status is null)
      </isEqual>
      <isEqual property="StateId" compareValue="3">
        AND cast(sysdate-RD.RTIME as integer) &gt;=15.1 and ((RD.ter_status not in ('2','5','6')) or RD.ter_status is null)
      </isEqual>
      <isEqual property="StateId" compareValue="4">
        and RD.ter_status='5'
      </isEqual>
      <isEqual property="StateId" compareValue="5">
        and RD.ter_status='2'
      </isEqual>
      <isEqual property="StateId" compareValue="6">
        and RD.ter_status='6'
      </isEqual>      
      <isEqual property="StateId" compareValue="7">
        and RD.RTIME IS NULL
      </isEqual>
      ORDER BY TI.TER_NO ASC
      <isGreaterThan property="EndData" compareValue="0">
        ) op_a) op_b Where op_b.rn &lt; #EndData# And op_b.rn &gt;= #StartData#
      </isGreaterThan>
    </select>

    <select id="GetTjbbTerDataCount" parameterClass="map" resultClass="int">
      SELECT count(*)
      FROM TERMINAL_INFO TI JOIN DEPT_INFO DI ON TI.DEPT_ID=DI.BUSINESSDIVISIONID
      <dynamic prepend="AND">
        <isNotEmpty prepend="AND" property="TerNo">
          TI.TER_NO LIKE '%'||#TerNo#||'%'
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="UserLname">
          TI.TER_NO in (select ter_no from SETMANAGER where username=#UserLname#)
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="ProId">
          TI.TER_TYPEID=#ProId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="StartTerNo">
          TI.TER_NO &gt;=#StartTerNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="EndTerNo">
          TI.TER_NO &lt;=#EndTerNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="DeptId">
          TI.DEPT_ID = #DeptId#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="Businessdivisioncode">
          DI.BUSINESSDIVISIONCODE LIKE #Businessdivisioncode#||'%'
        </isNotEmpty>
      </dynamic>
      LEFT JOIN CAR_INFO CI ON TI.CAR_ID = CI.CAR_ID
      LEFT JOIN　PRODUCTS_INFO PI ON TI.TER_TYPEID=PI.PRO_ID
      LEFT JOIN REALTIME_DATA RD ON TI.TER_NO= RD.TER_NO where 1=1
      <isNotEmpty prepend="AND" property="CarNo">
        CI.CAR_NO LIKE '%'||#CarNo#||'%'
      </isNotEmpty>
      <isEqual property="StateId" compareValue="1">
        AND cast(sysdate-RD.RTIME as integer)&lt;7.1 and ((RD.ter_status not in ('2','5','6')) or RD.ter_status is null)
      </isEqual>
      <isEqual property="StateId" compareValue="2">
        AND cast(sysdate-RD.RTIME as integer) &gt;=7.1 AND cast(sysdate-RD.RTIME as integer)&lt;15.1 and ((RD.ter_status not in ('2','5','6')) or RD.ter_status is null)
      </isEqual>
      <isEqual property="StateId" compareValue="3">
        AND cast(sysdate-RD.RTIME as integer) &gt;=15.1 and ((RD.ter_status not in ('2','5','6')) or RD.ter_status is null)
      </isEqual>
      <isEqual property="StateId" compareValue="4">
        and RD.ter_status='5'
      </isEqual>
      <isEqual property="StateId" compareValue="5">
        and RD.ter_status='2'
      </isEqual>
      <isEqual property="StateId" compareValue="6">
        and RD.ter_status='6'
      </isEqual>
      <isEqual property="StateId" compareValue="7">
        and RD.RTIME IS NULL
      </isEqual>
    </select>
  </statements>
</sqlMap>
